id: io.github.grisha765.winbox
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
command: winbox.sh
finish-args: 
  - --socket=pulseaudio
  - --socket=x11
  - --socket=wayland
  - --share=ipc
  - --device=dri
  - --share=network
  - --allow=multiarch

add-extensions:
  org.freedesktop.Platform.Compat.i386:
    directory: lib/i386-linux-gnu
    version: '23.08'

modules:
  - name: wine64
    buildsystem: simple
    build-commands:
      - mkdir -p build
      - cd build
      - ../wine64/configure --prefix=/app --libdir=/app/lib --with-x --enable-win64
      - make -j$(nproc)
      - make install
    sources:
      - type: archive
        url: https://dl.winehq.org/wine/source/9.0/wine-9.0.tar.xz
        sha256: 7cfd090a5395f5b76d95bb5defac8a312c8de4c070c1163b8b58da38330ca6ee

  - name: wine-mono
    buildsystem: simple
    build-commands:
      - install -Dm644 wine-mono-8.0.0-x86.msi /app/share/wine/mono/wine-mono.msi
    sources:
      - type: file
        url: https://dl.winehq.org/wine/wine-mono/9.0.0/wine-mono-9.0.0-x86.msi
        sha256: 79f6c43100675566c112f4199b9ea7b944d338164b34bd91fa11b0b0a414e1c4

  - name: winbox
    buildsystem: simple
    build-commands:
      - install -Dm755 winbox.sh /app/bin/winbox.sh
      - install -Dm755 winbox64.exe /app/bin/winbox.exe
      - install -Dm644 io.github.grisha765.winbox.svg /app/share/icons/hicolor/scalable/apps/io.github.grisha765.winbox.svg
      - install -Dm755 io.github.grisha765.winbox.desktop /app/share/applications/io.github.grisha765.winbox.desktop
    sources:
      - type: script
        dest-filename: winbox.sh
        commands:
          - export WINEPREFIX="$XDG_DATA_HOME/wine"
          - /app/bin/wine /app/bin/winbox.exe
      - type: file
        url: https://download.mikrotik.com/routeros/winbox/3.41/winbox64.exe
        sha256: 8bc3ecf1f35952600ecb1a380c38c88e9d63c081a32204fd094d588230070bf6
      - type: file 
        path: io.github.grisha765.winbox.svg
      - type: file
        path: io.github.grisha765.winbox.desktop

